

############################# Heartbeat ######################################

# Define a directory to load monitor definitions from. Definitions take the form
# of individual yaml files.
heartbeat.config.monitors:
  # Directory + glob pattern to search for configuration files
  path: ${path.config}/monitors.d/*.yml
  # If enabled, heartbeat will periodically check the config.monitors path for changes
  reload.enabled: false
  # How often to check for changes
  reload.period: 60s

# Configure monitors inline
heartbeat.monitors:
- type: http

  # List or urls to query
  name: kibana
  hosts: ["https://kibana:5601"]
  ssl:
    certificate_authorities: ['/usr/share/heartbeat/certs/ca/ca.crt']
    verification_mode: certificate

  # Configure task schedule
  schedule: '@every 30s'

  # Total test connection and data exchange timeout
  # timeout: 16s

- type: http
  name: es01
  hosts: ["https://es01:9200"]
  ssl:
    certificate_authorities: ['/usr/share/heartbeat/certs/ca/ca.crt']
    verification_mode: certificate

  # Configure task schedule
  schedule: '@every 30s'

- type: http
  name: es01_cluster
  hosts: ["https://es01:9300"]
  ssl:
    certificate_authorities: ['/usr/share/heartbeat/certs/ca/ca.crt']
    verification_mode: certificate

  # Configure task schedule
  schedule: '@every 30s'

#==================== Elasticsearch template setting ==========================

setup.template.settings:
  index.number_of_shards: 1
  index.codec: best_compression
  #_source.enabled: false

#============================== Kibana =====================================

# Starting with Beats version 6.0.0, the dashboards are loaded via the Kibana API.
# This requires a Kibana endpoint configuration.
setup.kibana:
  host: "https://kibana:5601"
  ssl:
    certificate_authorities: ["/usr/share/heartbeat/certs/ca/ca.crt"]
    certificate: "/usr/share/heartbeat/certs/kibana/kibana.crt"
    key: "/usr/share/heartbeat/certs/kibana/kibana.key"
    verification_mode: "certificate"

#================================ Outputs =====================================

# Configure what output to use when sending the data collected by the beat.

#-------------------------- Elasticsearch output ------------------------------
output.elasticsearch:
  hosts: ["es01:9200"]
  username: "elastic"
  password: "${ELASTIC_PASSWORD}"
  protocol: "https"
  ssl:
    certificate_authorities: ["/usr/share/heartbeat/certs/ca/ca.crt"]
    certificate: "/usr/share/heartbeat/certs/heartbeat/heartbeat.crt"
    key: "/usr/share/heartbeat/certs/heartbeat/heartbeat.key"
    verification_mode: "certificate"


#================================ Processors =====================================

processors:
  - add_observer_metadata:
      cache.ttl: 5m
  # Optional, but recommended geo settings for the location Heartbeat is running in
      geo:
        # Token describing this location
        name: ottawa-dell-server
        country_iso_code: CA
        region_name: Ontario
        region_iso_code: ON
        city_name: Ottawa

        # Lat, Lon "
        #location: "37.926868, -78.024902"

#================================ Processors =====================================

# Configure processors to enhance or manipulate events generated by the beat.

processors:
  - add_host_metadata: ~
  - add_cloud_metadata: ~


#============================== X-Pack Monitoring ===============================
# heartbeat can export internal metrics to a central Elasticsearch monitoring
# cluster.  This requires xpack monitoring to be enabled in Elasticsearch.  The
# reporting is disabled by default.

# Set to true to enable the monitoring reporter.
monitoring.enabled: true

